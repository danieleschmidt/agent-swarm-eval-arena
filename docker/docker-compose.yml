version: '3.8'\n\nservices:\n  swarm-arena:\n    build:\n      context: ..\n      dockerfile: docker/Dockerfile\n    image: swarm-arena:latest\n    container_name: swarm-arena-main\n    ports:\n      - \"8765:8765\"  # WebSocket telemetry\n      - \"8080:8080\"  # HTTP API\n    environment:\n      - SWARM_ARENA_ENV=production\n      - RAY_ADDRESS=ray://ray-head:10001\n      - REDIS_URL=redis://redis:6379\n    volumes:\n      - ./data:/app/data\n      - ./logs:/app/logs\n    depends_on:\n      - redis\n      - ray-head\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    \n  ray-head:\n    image: rayproject/ray:2.8.0-py39\n    container_name: swarm-ray-head\n    command: >\n      ray start --head \n      --dashboard-host=0.0.0.0 \n      --dashboard-port=8265\n      --port=6379\n      --redis-password=swarm-arena-redis\n    ports:\n      - \"8265:8265\"  # Ray Dashboard\n      - \"10001:10001\"  # Ray Client\n    environment:\n      - RAY_REDIS_PASSWORD=swarm-arena-redis\n    volumes:\n      - ray-data:/tmp/ray\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    \n  ray-worker:\n    image: rayproject/ray:2.8.0-py39\n    command: >\n      ray start --address=ray-head:6379\n      --redis-password=swarm-arena-redis\n    depends_on:\n      - ray-head\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    deploy:\n      replicas: 2\n      \n  redis:\n    image: redis:7-alpine\n    container_name: swarm-redis\n    command: redis-server --requirepass swarm-arena-redis\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis-data:/data\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    \n  monitoring:\n    image: prom/prometheus:latest\n    container_name: swarm-prometheus\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus-data:/prometheus\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    \n  grafana:\n    image: grafana/grafana:latest\n    container_name: swarm-grafana\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=swarm-arena-admin\n    volumes:\n      - grafana-data:/var/lib/grafana\n      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards\n      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources\n    networks:\n      - swarm-network\n    restart: unless-stopped\n    depends_on:\n      - monitoring\n\nvolumes:\n  ray-data:\n  redis-data:\n  prometheus-data:\n  grafana-data:\n\nnetworks:\n  swarm-network:\n    driver: bridge"