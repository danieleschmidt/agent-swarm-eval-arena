apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: ray-head\n  namespace: swarm-arena\n  labels:\n    app: ray-head\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: ray-head\n  template:\n    metadata:\n      labels:\n        app: ray-head\n    spec:\n      containers:\n      - name: ray-head\n        image: rayproject/ray:2.8.0-py39\n        command: [\"/bin/bash\", \"-c\"]\n        args:\n        - >\n          ray start --head \n          --dashboard-host=0.0.0.0 \n          --dashboard-port=8265\n          --port=6379\n          --redis-password=$(REDIS_PASSWORD) &&\n          sleep infinity\n        ports:\n        - containerPort: 8265\n          name: dashboard\n        - containerPort: 10001\n          name: client\n        - containerPort: 6379\n          name: redis\n        env:\n        - name: REDIS_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: swarm-arena-secrets\n              key: redis-password\n        resources:\n          requests:\n            memory: \"1Gi\"\n            cpu: \"500m\"\n          limits:\n            memory: \"4Gi\"\n            cpu: \"2000m\"\n        volumeMounts:\n        - name: ray-storage\n          mountPath: /tmp/ray\n      volumes:\n      - name: ray-storage\n        emptyDir: {}\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: ray-head-service\n  namespace: swarm-arena\nspec:\n  selector:\n    app: ray-head\n  ports:\n  - name: dashboard\n    port: 8265\n    targetPort: 8265\n  - name: client\n    port: 10001\n    targetPort: 10001\n  - name: redis\n    port: 6379\n    targetPort: 6379\n  type: ClusterIP\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: ray-worker\n  namespace: swarm-arena\n  labels:\n    app: ray-worker\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: ray-worker\n  template:\n    metadata:\n      labels:\n        app: ray-worker\n    spec:\n      containers:\n      - name: ray-worker\n        image: rayproject/ray:2.8.0-py39\n        command: [\"/bin/bash\", \"-c\"]\n        args:\n        - >\n          ray start --address=ray-head-service:6379\n          --redis-password=$(REDIS_PASSWORD) &&\n          sleep infinity\n        env:\n        - name: REDIS_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: swarm-arena-secrets\n              key: redis-password\n        resources:\n          requests:\n            memory: \"2Gi\"\n            cpu: \"1000m\"\n          limits:\n            memory: \"8Gi\"\n            cpu: \"4000m\"\n        volumeMounts:\n        - name: ray-storage\n          mountPath: /tmp/ray\n      volumes:\n      - name: ray-storage\n        emptyDir: {}"